{% extends 'base.html' %}

{% block styles %}
<link rel="stylesheet" href="/static/css/admin.css">
{% endblock %}

{% block title %}Admin - More Points{% endblock %}


{% block content %}
<header>
    <a class="title primary" href="/admin">More Points</a>
</header>
<div class="toolbar">
    <span class="title">All sites</span><br>
    <a class="clickable button" onclick="createSite()">+ Site</a>
    <a class="clickable button" href="/admin/logout">x Logout</a>
</div>
<section>
    Remember to restart FTP server (server.py) when you create or modify a site
</section>
<section class="list-view">
    <div class="toolbar">
        <input id="searchBox" type="text" placeholder="Search site">
        <button onclick="window.location.href = `/admin?search=${searchBox.value}`">Search</button>
    </div>
    <table cellspacing="0">
        <tr>
            <th style="width: 100%;">Site name</th>
            <th style="width: 10%;"></th>
        </tr>
        {% for site in sites %}
            <tr>
                <td>
                    <div class="file">
                        <a href="/admin/edit_site/{{ site }}">{{ site }}</a>
                    </div>
                </td>
                <td>
                    <div>
                        <a href="/site/{{ site }}" class="clickable icon-cont" target="_blank"><span class="icon">ï‘¥</span></a>
                    </div>
                </td>
            </tr>
        {% endfor %}
    </table>
</section>

<script>
    async function createSite(){
        const sitename = filenamePrompt("Enter site name");
	if (sitename){
		const data = await fetch(`/admin/create_site`, {
		    method: 'POST',
		    body: JSON.stringify({
		        "sitename": sitename,
		    }),
		    headers: {"Content-type": "application/json; charset=UTF-8"}
		})
		reviewResponse(await data.json())
	}
    }
</script>
{% endblock %}
